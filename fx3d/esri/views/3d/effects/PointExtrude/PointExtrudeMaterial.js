/**
 * Copyright @ 2020 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/text!./PointExtrudeMaterial.xml","esri/core/declare","../../webgl-engine-extensions/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils","../Materials"],function(i,t,e,r,s,n){var a=t([n],{declaredClass:"esri.views.3d.effects.PointExtrude.PointExtrudeMaterial",constructor:function(i){this._gl=i.gl,this._shaderSnippets=i.shaderSnippets,this._program=null,this._pushState=i.pushState,this._restoreState=i.restoreState,this._viewingMode=i.viewingMode},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},_addDefines:function(i,t){var e="";if(null!=t)if(Array.isArray(t))for(var r=0,s=t.length;r<s;r++){var n=t[r];e+="#define "+n+"\n"}else for(var n in t)e+="#define "+n+"\n";return this._shaderSnippets.defines+"\n"+e+i},loadShaders:function(){if(this._shaderSnippets){null!=this._shaderSnippets.pointExtrudeVS&&null!=this._shaderSnippets.pointExtrudeFS||this._shaderSnippets._parse(i);var t=[];"global"==this._viewingMode?t.push("GLOBAL"):t.push("LOCAL");var s=this._addDefines(this._shaderSnippets.pointExtrudeVS,t),n=new e(35633,s,this._gl),a=new e(35632,this._shaderSnippets.pointExtrudeFS,this._gl);this._program=new r([n,a],this._gl)}return this._initResources()},_initResources:function(){return!0},bind:function(i,t){this._program.use(),this._program.uniformMatrix4fv("ie",i.proj),this._program.uniform4fv("sp",i.viewport),this._program.uniform3fv("lo",i.lightingData.direction),this._program.uniform4fv("im",i.lightingData.ambient),this._program.uniform4fv("ms",i.lightingData.diffuse),this._program.uniform4fv("es",i.lightingData.specular),this._oldTex=this._gl.getParameter(32873);var e=this.getOldActiveUnit(t);i.so.bind(e+1),this._program.uniform1i("so",e+1),i.pl.bind(e+2),this._program.uniform1i("pl",e+2),this._program.uniform2fv("pi",i.pi),this._program.uniform2f("si",i.si,i.sl),this._program.uniform3fv("ol",i.ol),this._gl.activeTexture(33984+e+3),this._gl.bindTexture(3553,i.ls),this._program.uniform1i("ls",e+3),this._program.uniform1f("op",i.op),this._program.uniform1f("pe",i.pe),this._program.uniform3fv("oi",i.oi),this._program.uniform1f("is",i.time),this._program.uniform1i("po",i.reachedRepeatLimit),this._program.uniform1f("ss",i.ss),this._program.uniform1f("ps",i.zoom),1!=t._depthTestEnabled&&(this._pushState(["setDepthTestEnabled",t._depthTestEnabled]),t.setDepthTestEnabled(!0)),1!=t._polygonCullingEnabled&&(this._pushState(["setFaceCullingEnabled",t._polygonCullingEnabled]),t.setFaceCullingEnabled(!0)),1029!=t._cullFace&&(this._pushState(["setCullFace",t._cullFace]),t.setCullFace(1029)),1!=t._blendEnabled&&(this._pushState(["setBlendingEnabled",t._blendEnabled]),t.setBlendingEnabled(!0))},bindVec3f:function(i,t,e,r){this._program.uniform3f(i,t,e,r)},bindVec3fv:function(i,t){this._program.uniform3fv(i,t)},bindMat4:function(i,t){this._program.uniformMatrix4fv(i,t)},release:function(i){this._gl.activeTexture(33984+i._activeTextureUnit+1),this._gl.bindTexture(3553,this._oldTex),this._restoreState(i),this._gl.useProgram(null)}});return a});